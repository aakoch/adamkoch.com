{ "component": "import { Component, OnDestroy, ViewChild } from '@angular/core';\nimport { NgForm } from '@angular/forms';\nimport { combineLatestWith, filter, Subscription, switchMap, tap } from 'rxjs';\nimport { NetlifyFormsService } from '../../blog/netlify-forms.service';\nimport { CommentFormData } from './comment-form-data';\n\n@Component({\n  selector: 'app-comment-form',\n  templateUrl: './comment-form.component.html',\n  styleUrls: ['./comment-form.component.scss']\n})\nexport class CommentFormComponent implements OnDestroy {\n  @ViewChild('formRef')\n  form!: NgForm;\n  beingSubmitted: boolean = false;\n  isSuccess = false;\n  isError = false;\n  error?: string;\n\n  model: CommentFormData = { name: '', comment: '', 'form-name': 'post-comment-form', email: '', url: '' };\n  formSubscription?: Subscription;\n\n  constructor(private netlifyForms: NetlifyFormsService) {\n  }\n\n  ngAfterViewInit() {\n    this.formSubscription = this.form.valueChanges?.pipe(\n      filter(() => this.form.valid! && !this.form.pristine!),\n      combineLatestWith(this.form.ngSubmit), \n      filter(() => !this.beingSubmitted),\n      tap(() => this.beingSubmitted = true),\n      switchMap(() => this.netlifyForms.submitFeedback(this.model as CommentFormData)),\n    )\n      .subscribe({\n        next: () => {\n          this.beingSubmitted = false;\n          this.isSuccess = true;\n        },\n        error: (err) => {\n          console.error(\"There was an error with form submission\", err);\n          this.isError = true;\n          this.error = err;\n        }\n      });\n  }\n\n  ngOnDestroy() {\n    this.formSubscription?.unsubscribe();\n  }\n}\n", "service": "import { HttpClient, HttpErrorResponse, HttpParams } from '@angular/common/http';\nimport { Injectable, isDevMode } from '@angular/core';\nimport { Observable, throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { CommentFormData } from '../shared/comment-form/comment-form-data';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NetlifyFormsService {\n\n  constructor(private http: HttpClient) { }\n\n  submitFeedback(commentEntry: CommentFormData): Observable<any> {\n\n    const entry = new HttpParams({ fromObject: {\n      ...commentEntry\n    }});\n\n    return this.http.post(\n      isDevMode() ? 'http://localhost:8000/' : '/',\n      entry.toString(),\n      {\n        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n        responseType: 'text'\n      }\n    ).pipe(catchError(this.handleError));\n  }\n\n  private handleError(err: HttpErrorResponse) {\n    let errMsg = '';\n\n    if (err.error instanceof ErrorEvent) {\n      errMsg = `A client-side error occurred: ${err.error.message}`;\n    } else {\n      errMsg = `A server-side error occurred. Code: ${err.status}. Message: ${err.message}`;\n    }\n\n    return throwError(() => new Error(errMsg));\n  }\n}\n"}