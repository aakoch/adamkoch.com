{"landing_page":"<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>SSE</title>\n</head>\n\n<body>\n  <h1>SSE demo with PHP</h1>\n\n  <a href=\"db.php\" target=\"_blank\">Click here to open a window which will create a DB entry</a>\n  <br />\n  Each time a new entry is added to the database, an event is pushed to this page.\n  <br />\n  The link above can be refreshed to add a new event/record in the DB.\n\n  <ol id=\"list\">\n  </ol>\n\n  <script>\n    // Create new event, the server script is sse.php\n    var eventSource = new EventSource(\"sse.php\");\n\n    // Event when receiving a message from the server\n    eventSource.onmessage = function (event) {\n      // Append the message to the ordered list\n      document.getElementById(\"list\").innerHTML += '<li>' + event.data + \"</li>\";\n    };\n  </script>\n</body>\n\n</html>","sse_page":"<?php\n\n// Lots of code taken from https://kevinchoppin.dev/blog/server-sent-events-in-php\n\n$servername = \"<your value>\";\n$username = \"<your value>\";\n$password = \"<your value>\";\n$dbname = \"<your value>\";\n\ntry {\n  // make session read-only\n  session_start();\n  session_write_close();\n\n  // disable default disconnect checks\n  ignore_user_abort(true);\n\n  // set headers for stream\n  header(\"Content-Type: text/event-stream\");\n  header(\"Cache-Control: no-cache\");\n  header(\"Access-Control-Allow-Origin: *\");\n\n  // Is this a new stream or an existing one?\n  $lastEventId = floatval(isset($_SERVER[\"HTTP_LAST_EVENT_ID\"]) ? $_SERVER[\"HTTP_LAST_EVENT_ID\"] : 0);\n  if ($lastEventId == 0) {\n    $lastEventId = floatval(isset($_GET[\"lastEventId\"]) ? $_GET[\"lastEventId\"] : 0);\n  }\n\n  echo \":\" . str_repeat(\" \", 2048) . \"\\n\"; // 2 kB padding for IE\n  echo \"retry: 2000\\n\";\n\n  // start stream\n  while (true) {\n    if (connection_aborted()) {\n      exit();\n    } else {\n\n      $conn = new mysqli($servername, $username, $password, $dbname);\n      if ($conn->connect_error) {\n        die(\"Connection failed: \" . $conn->connect_error);\n      }\n\n      $sql = \"SELECT * FROM messages\\n\"\n        . \"order by id desc\\n\"\n        . \"limit 1\";\n\n      $result = $conn->query($sql);\n\n      if ($result->num_rows > 0) {\n        if ($row = $result->fetch_assoc()) {\n          $latestEventId = $row['id'];\n\n          if ($lastEventId < $latestEventId) {\n            echo \"id: \" . $latestEventId . \"\\n\";\n            $time = $row['timestamp'];\n            echo \"data: A record was recorded at: {$time}\\n\\n\";\n\n            $lastEventId = $latestEventId;\n            ob_flush();\n            flush();\n          } else {\n            // no new data to send\n            echo \": heartbeat\\n\\n\";\n            ob_flush();\n            flush();\n          }\n        }\n      }\n    }\n\n    // 2 second sleep then carry on\n    sleep(2);\n  }\n} catch (Exception $e) {\n  echo 'Message: ' . $e->getMessage();\n}\n","db_update_page":"<?php\n$servername = \"<your value>\";\n$username = \"<your value>\";\n$password = \"<your value>\";\n$dbname = \"<your value>\";\n\n$conn = new mysqli($servername, $username, $password, $dbname);\nif ($conn->connect_error) {\n  die(\"Connection failed: \" . $conn->connect_error);\n}\n\n$sql = \"INSERT INTO messages () VALUES ()\";\n\nif ($conn->query($sql) === TRUE) {\n  $data = \"New record created successfully\";\n} else {\n  $data =  \"Error: \" . $sql . \"<br>\" . $conn->error;\n}\n\n$conn->close();\n?>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document</title>\n</head>\n<body>\n\n<section><?= $data ?></section>\n\n<section>\n  <button type=\"button\" onclick=\"location.reload()\">Reload</button> the page for a new entry\n</section>\n\n  \n</body>\n</html>"}